{
  "name": "crossgen",
  "description": "Automated crossword puzzle generation pipeline using constraint satisfaction, Peter Broda's wordlist, and LLM-generated clues",
  "branchName": "ralph/puzzle-generation-pipeline",
  "userStories": [
    {
      "id": "US-GEN-001",
      "title": "Grid data structures and types",
      "description": "As a developer, I need core data structures for representing grids, cells, and entries so that I can build the generation pipeline.",
      "acceptanceCriteria": [
        "Grid struct with Size, Cells, and Entries fields defined",
        "Cell struct with Row, Col, IsBlack, Letter, and Number fields",
        "Entry struct with Number, Direction, StartRow, StartCol, Length, and Cells",
        "Direction enum with ACROSS and DOWN values",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-002",
      "title": "Empty grid initialization",
      "description": "As a developer, I need to create empty 15x15 grids so that I can populate them with black squares.",
      "acceptanceCriteria": [
        "NewEmptyGrid function creates 15x15 grid with all white cells",
        "All cells initialized with Letter = 0 (unfilled)",
        "All cells initialized with Number = 0 (no clue number)",
        "Grid dimensions configurable via GridConfig",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-001"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-003",
      "title": "Black square seeding algorithm",
      "description": "As a developer, I need to randomly place black squares in the grid so that I can create valid crossword patterns.",
      "acceptanceCriteria": [
        "seedBlackSquares places black squares in top-left quadrant only",
        "Black density parameter controls percentage (16-20%)",
        "Random placement uses configurable seed for reproducibility",
        "Black squares marked with IsBlack = true",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-002"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-004",
      "title": "180-degree rotational symmetry enforcement",
      "description": "As a developer, I need to mirror black squares rotationally so that grids follow standard crossword conventions.",
      "acceptanceCriteria": [
        "enforceSymmetry mirrors black squares from top-left to bottom-right",
        "180-degree rotation symmetry verified after mirroring",
        "Center cell (7,7 for 15x15) handled correctly",
        "Symmetry validation function returns true for valid grids",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-003"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-005",
      "title": "Grid connectivity validation",
      "description": "As a developer, I need to verify all white cells are connected so that puzzles don't have isolated regions.",
      "acceptanceCriteria": [
        "isConnected uses flood fill algorithm from center cell",
        "Returns false if any white cell unreachable",
        "Returns true only when all white cells connected",
        "ErrDisconnectedGrid returned for invalid grids",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-004"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-006",
      "title": "Word length validation",
      "description": "As a developer, I need to ensure no words are too short so that puzzles avoid 2-letter entries.",
      "acceptanceCriteria": [
        "hasShortWords checks all horizontal and vertical word slots",
        "Returns true if any word shorter than MinWordLength (default 3)",
        "Counts consecutive white cells correctly",
        "ErrShortWords returned for invalid grids",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-005"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-007",
      "title": "Entry slot computation",
      "description": "As a developer, I need to extract word slots from grids so that I can fill them with words.",
      "acceptanceCriteria": [
        "computeEntries identifies all across and down word slots",
        "Each entry has correct StartRow, StartCol, Length",
        "Entry.Cells contains pointers to grid cells for that word",
        "Across entries scanned left-to-right, top-to-bottom",
        "Down entries scanned top-to-bottom, left-to-right",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-006"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-008",
      "title": "Clue number assignment",
      "description": "As a developer, I need to number cells for clues so that solvers know which clues correspond to which words.",
      "acceptanceCriteria": [
        "assignNumbers numbers cells left-to-right, top-to-bottom",
        "Only cells starting across or down word get numbers",
        "Numbers sequential starting from 1",
        "Entry.Number set correctly for each word slot",
        "Cell.Number set for cells with clue numbers",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-007"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-009",
      "title": "Complete grid generation function",
      "description": "As a developer, I need an end-to-end grid generator so that I can create valid empty grids.",
      "acceptanceCriteria": [
        "Generate function accepts GridConfig parameter",
        "Returns valid grid or error if generation fails",
        "Retries with new seed if validation fails (max 100 attempts)",
        "All validation steps execute in correct order",
        "Difficulty presets (Easy/Medium/Hard/Expert) map to black density",
        "go test ./pkg/grid/... passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-008"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-010",
      "title": "Wordlist file loader",
      "description": "As a developer, I need to load Peter Broda's wordlist so that I can use it for filling grids.",
      "acceptanceCriteria": [
        "LoadBrodaWordlist parses WORD;SCORE format correctly",
        "Words grouped by length in ByLength map",
        "Each length bucket sorted by score descending",
        "Returns error for missing or malformed file",
        "Handles uppercase conversion for all words",
        "go test ./pkg/wordlist/... passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-011",
      "title": "Trie data structure for prefix matching",
      "description": "As a developer, I need a trie for fast word lookups so that I can match partial patterns efficiently.",
      "acceptanceCriteria": [
        "Trie.Insert adds words with score metadata",
        "Trie.Match finds words matching pattern (e.g., 'J__Z')",
        "Underscore _ matches any letter in pattern",
        "Results sorted by score descending",
        "Returns empty slice for no matches",
        "go test ./pkg/wordlist/... passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-010"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-012",
      "title": "Pattern extraction from grid entries",
      "description": "As a developer, I need to extract letter patterns from entries so that I can find matching words.",
      "acceptanceCriteria": [
        "getPattern returns string with letters and underscores",
        "Filled cells show letter, unfilled cells show underscore",
        "Pattern length matches entry length",
        "Crossing letters from perpendicular words included",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-011"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-013",
      "title": "Entry constraint sorting",
      "description": "As a developer, I need to prioritize constrained entries so that backtracking search is more efficient.",
      "acceptanceCriteria": [
        "sortByConstraint orders entries by number of crossing words (descending)",
        "Secondary sort by pattern specificity (fewest matching words)",
        "Corner/edge entries processed before center entries",
        "Returns sorted slice of entries",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-012"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-014",
      "title": "Word placement and removal functions",
      "description": "As a developer, I need to place and remove words from the grid so that I can implement backtracking.",
      "acceptanceCriteria": [
        "placeWord fills entry cells with word letters",
        "removeWord clears entry cells back to unfilled (Letter = 0)",
        "Handles crossing cells correctly (only clear if not part of filled perpendicular word)",
        "Updates grid state atomically",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-013"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-015",
      "title": "Conflict detection for word candidates",
      "description": "As a developer, I need to check if a word conflicts with existing fills so that I avoid invalid placements.",
      "acceptanceCriteria": [
        "conflictsWithFilled checks crossing letters match",
        "Returns true if any crossing letter differs",
        "Returns false if all crossings compatible or unfilled",
        "Handles edge cases (no crossings, all empty)",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-014"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-016",
      "title": "Backtracking fill algorithm",
      "description": "As a developer, I need a recursive fill algorithm so that I can populate grids with valid words.",
      "acceptanceCriteria": [
        "fillRecursive fills entries in constraint-sorted order",
        "Tries candidates matching pattern and MinScore threshold",
        "Backtracks when no valid candidate found",
        "Returns nil on successful fill, ErrNoValidFill on failure",
        "Respects MaxRetries limit before giving up",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-015"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-017",
      "title": "Fill engine with quality controls",
      "description": "As a developer, I need a fill engine that enforces quality rules so that puzzles use good words.",
      "acceptanceCriteria": [
        "FillEngine.Fill executes full fill algorithm",
        "Enforces MinScore threshold (default 50)",
        "Prevents duplicate words within puzzle",
        "Tracks used words in fill session",
        "Returns error if fill impossible with constraints",
        "go test ./pkg/fill/... passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-016"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-018",
      "title": "Anthropic Claude API client",
      "description": "As a developer, I need to call Claude API for clue generation so that I can produce natural clues.",
      "acceptanceCriteria": [
        "AnthropicClient implements LLMClient interface",
        "Complete method sends prompt to Claude API",
        "Handles API errors and retries with exponential backoff",
        "Supports Haiku and Sonnet model selection",
        "Returns parsed text response",
        "go test ./pkg/clues/providers/... passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-019",
      "title": "Ollama local LLM client",
      "description": "As a developer, I need to call local Ollama models so that I can generate clues offline.",
      "acceptanceCriteria": [
        "OllamaClient implements LLMClient interface",
        "Complete method sends prompt to Ollama API",
        "Supports model selection (Llama, Mistral, etc.)",
        "Returns parsed text response",
        "Handles connection errors gracefully",
        "go test ./pkg/clues/providers/... passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-020",
      "title": "Clue prompt template builder",
      "description": "As a developer, I need to construct LLM prompts so that I can request properly formatted clues.",
      "acceptanceCriteria": [
        "buildPrompt accepts batch of words and difficulty",
        "Template includes difficulty guidelines (easy/medium/hard)",
        "Requests JSON response format with word-to-clue mapping",
        "Batches up to 20 words per prompt for efficiency",
        "go test ./pkg/clues/... passes"
      ],
      "priority": 20,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-018",
        "US-GEN-019"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-021",
      "title": "Clue response parser",
      "description": "As a developer, I need to parse LLM JSON responses so that I can extract clues for each word.",
      "acceptanceCriteria": [
        "parseClueResponse parses JSON with clues object",
        "Returns map[string]string of word to clue",
        "Handles malformed JSON gracefully with error",
        "Validates all requested words have clues",
        "go test ./pkg/clues/... passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-020"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-022",
      "title": "Clue cache database schema",
      "description": "As a developer, I need a SQLite schema for caching clues so that I can reuse clues and reduce API costs.",
      "acceptanceCriteria": [
        "clue_cache table with word, clue, difficulty, created_at columns",
        "Index on word + difficulty for fast lookups",
        "Migration creates table if not exists",
        "Schema supports multiple clues per word/difficulty",
        "go test ./pkg/clues/... passes"
      ],
      "priority": 22,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-023",
      "title": "Clue cache implementation",
      "description": "As a developer, I need to save and retrieve cached clues so that I can generate puzzles faster and cheaper.",
      "acceptanceCriteria": [
        "ClueCache.GetClue retrieves random cached clue for word/difficulty",
        "ClueCache.SaveClue inserts new clue into database",
        "Returns (clue, true) if found, (\"\", false) if not",
        "Handles database errors gracefully",
        "go test ./pkg/clues/... passes"
      ],
      "priority": 23,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-022"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-024",
      "title": "Clue generator with caching",
      "description": "As a developer, I need an end-to-end clue generator so that I can produce clues for filled grids.",
      "acceptanceCriteria": [
        "GenerateClues checks cache before calling LLM",
        "Falls back to LLM if cache miss",
        "Saves new clues to cache after generation",
        "Batches words for efficient API usage",
        "Returns map of entry key to clue text",
        "go test ./pkg/clues/... passes"
      ],
      "priority": 24,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-021",
        "US-GEN-023"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-025",
      "title": "JSON output formatter",
      "description": "As a developer, I need to export puzzles as JSON so that Crossy can consume them.",
      "acceptanceCriteria": [
        "FormatJSON converts Puzzle to PuzzleJSON struct",
        "Grid exported as 2D array with letters or '.' for black cells",
        "Clues grouped into across and down arrays",
        "Each clue includes number, text, answer, and length",
        "Metadata includes ID, title, author, difficulty, timestamps",
        "go test ./pkg/output/... passes"
      ],
      "priority": 25,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-026",
      "title": "Across Lite .puz formatter",
      "description": "As a developer, I need to export .puz files so that puzzles work in desktop solvers.",
      "acceptanceCriteria": [
        "FormatPuz converts Puzzle to .puz binary format",
        "Includes grid solution and clues",
        "Metadata (title, author, copyright) embedded",
        "File validates in AcrossLite or compatible solver",
        "go test ./pkg/output/... passes"
      ],
      "priority": 26,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-025"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-027",
      "title": "ipuz JSON formatter",
      "description": "As a developer, I need to export .ipuz files so that puzzles work in modern web solvers.",
      "acceptanceCriteria": [
        "FormatIPuz converts Puzzle to ipuz JSON schema",
        "Includes grid, clues, solution, and metadata",
        "Validates against ipuz specification",
        "File loads in ipuz-compatible solvers",
        "go test ./pkg/output/... passes"
      ],
      "priority": 27,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-025"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-028",
      "title": "High-level Puzzle type and orchestration",
      "description": "As a developer, I need a Puzzle type that ties grid, fill, and clues together so that I can represent complete puzzles.",
      "acceptanceCriteria": [
        "Puzzle struct contains Grid, Clues map, and Metadata",
        "GeneratePuzzle orchestrates grid generation, fill, and clue generation",
        "Returns complete Puzzle ready for export",
        "Handles errors from any pipeline stage",
        "go test ./pkg/puzzle/... passes"
      ],
      "priority": 28,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-009",
        "US-GEN-017",
        "US-GEN-024"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-029",
      "title": "CLI framework with cobra",
      "description": "As a user, I need a CLI entrypoint so that I can run the puzzle generator from the command line.",
      "acceptanceCriteria": [
        "Root command crossgen with version and help",
        "Subcommands: generate, validate, convert, stats",
        "Global flags for verbosity and config file",
        "Help text for all commands and flags",
        "go build ./cmd/crossgen builds successfully"
      ],
      "priority": 29,
      "passes": true,
      "notes": "",
      "dependsOn": [],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-030",
      "title": "Generate command implementation",
      "description": "As a user, I want to generate puzzles via CLI so that I can create batches of crosswords.",
      "acceptanceCriteria": [
        "crossgen generate accepts --count, --difficulty, --output flags",
        "Supports --format (json, puz, ipuz, all)",
        "Supports --wordlist path to Broda wordlist",
        "Supports --llm (anthropic, ollama, cache-only)",
        "Generates N puzzles sequentially",
        "Writes output files to specified directory",
        "Shows progress bar during generation",
        "go build ./cmd/crossgen && ./crossgen generate --count 10 works"
      ],
      "priority": 30,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-028",
        "US-GEN-029"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-031",
      "title": "Validate command implementation",
      "description": "As a user, I want to validate puzzle files so that I can verify they're correct.",
      "acceptanceCriteria": [
        "crossgen validate accepts --input flag (file or directory)",
        "Checks grid symmetry, connectivity, word lengths",
        "Validates clue completeness and format",
        "Prints errors for invalid puzzles",
        "Exits with code 0 if all valid, 1 if any invalid",
        "go build ./cmd/crossgen && ./crossgen validate works"
      ],
      "priority": 31,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-029"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-032",
      "title": "Convert command implementation",
      "description": "As a user, I want to convert between puzzle formats so that I can use puzzles in different solvers.",
      "acceptanceCriteria": [
        "crossgen convert accepts --input, --output, --format flags",
        "Reads puzzle from input file",
        "Converts to target format (json, puz, ipuz)",
        "Writes to output file",
        "Handles errors gracefully with helpful messages",
        "go build ./cmd/crossgen && ./crossgen convert works"
      ],
      "priority": 32,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-026",
        "US-GEN-027",
        "US-GEN-029"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-033",
      "title": "Stats command implementation",
      "description": "As a user, I want to see cache statistics so that I can monitor clue cache usage.",
      "acceptanceCriteria": [
        "crossgen stats accepts --db flag for cache database path",
        "Shows total cached clues by difficulty",
        "Shows cache hit rate if available",
        "Shows most/least common cached words",
        "go build ./cmd/crossgen && ./crossgen stats works"
      ],
      "priority": 33,
      "passes": true,
      "notes": "",
      "dependsOn": [
        "US-GEN-023",
        "US-GEN-029"
      ],
      "completionNotes": "Completed by agent"
    },
    {
      "id": "US-GEN-034",
      "title": "Integration test: generate 10 easy puzzles",
      "description": "As a developer, I need end-to-end integration tests so that I can verify the complete pipeline works.",
      "acceptanceCriteria": [
        "Test generates 10 easy puzzles with cache-only mode",
        "All puzzles pass validation",
        "Output files created in expected formats",
        "No panics or unexpected errors",
        "go test ./integration/... passes"
      ],
      "priority": 34,
      "passes": false,
      "notes": "",
      "dependsOn": [
        "US-GEN-030",
        "US-GEN-031"
      ]
    },
    {
      "id": "US-GEN-035",
      "title": "README with usage examples",
      "description": "As a user, I want documentation so that I can understand how to use the tool.",
      "acceptanceCriteria": [
        "README includes project overview and goals",
        "Installation instructions provided",
        "Usage examples for all commands",
        "Wordlist setup instructions included",
        "LLM provider setup documented (Anthropic, Ollama)",
        "Example output files shown"
      ],
      "priority": 35,
      "passes": false,
      "notes": "",
      "dependsOn": [
        "US-GEN-030",
        "US-GEN-031",
        "US-GEN-032",
        "US-GEN-033"
      ]
    }
  ],
  "metadata": {
    "updatedAt": "2026-01-19T18:11:47.866Z"
  }
}